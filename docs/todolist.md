# 任务管理MCP服务开发计划

本文档列出了任务管理MCP服务的开发待办事项和优先级。

## 1. 核心功能开发

### 必须完成
- [x] 创建基本项目结构
- [x] 实现`Task`数据模型
- [x] 实现内存存储层`TaskStorage`
- [x] 实现`decompose_prd`工具
- [x] 实现`add_task`工具 
- [x] 实现`update_task`工具 (包含状态、依赖、代码引用等更新)
- [x] ~~实现`set_task_dependency`工具~~ (已合并到`update_task`)
- [x] ~~实现`remove_task_dependency`工具~~ (通过`update_task`设置空依赖实现)
- [x] 实现`get_task_list`工具
- [x] 实现`get_next_executable_task`工具
- [x] 实现`use_description`工具
- [x] 实现任务依赖循环检测
- [x] 实现任务状态转换验证逻辑
- [x] 添加完整错误处理和返回

### 优先级高
- [x] 实现PRD解析器与LLM集成
- [x] 添加任务优先级支持
- [x] 添加健康检查接口
- [x] 将PRD解析器从DeepSeek切换到Gemini模型
- [x] 优化Gemini PRD解析使用结构化输出
- [ ] 编写单元测试
- [x] 添加日志记录
- [ ] 完善配置管理

### 优先级中
- [x] 支持任务截止日期
- [ ] 实现持久化存储 (SQLite)
- [x] 增加任务标签功能
- [ ] 添加工具使用示例
- [x] 实现任务统计功能
- [ ] 添加性能优化
- [x] 清理未使用的工具类和代码
- [x] 优化 decompose_prd 工具，仅生成主任务并输出到 MD 文件
- [x] 添加 expand_task 工具，支持生成子任务
- [x] 重构 LLM 接口，将子任务生成逻辑移到具体 LLM 实现中
- [x] 改进任务描述生成，增加复杂度字段
- [x] 改进子任务描述生成，添加 code_references 和 complexity 字段
- [x] 添加 update_task_code_references 工具
- [x] decompose_prd 调用前自动清空任务
- [x] expand_task 支持重复调用和自定义子任务数量
- [x] 在Task模型中添加subtasks属性，支持嵌套子任务
- [x] 修改_task_to_dict方法，确保包含subtasks字段
- [x] 优化get_next_executable_task仅返回单个最优先任务
- [x] 移除 mark_task_done 工具，改为统一使用 update_task 更新任务状态

### 优先级低
- [ ] 实现更高级的数据库支持 (PostgreSQL)
- [ ] 添加用户认证
- [ ] 实现多团队支持
- [ ] 实现界面预览生成
- [ ] 集成CI/CD流程

## 2. 文档完善

### 必须完成
- [x] 编写设计文档 (design.md)
- [x] 编写MCP调用规则文档 (mcp-rules.md)
- [x] 编写快速入门指南 (getting-started.md)
- [x] 编写API参考文档 (api-reference.md)
- [x] 编写实现指南 (implementation-guide.md)
- [x] 编写配置示例 (config-example.md)
- [x] 编写详细安装指南 (installation.md)
- [x] 编写开发者指南 (contributing.md)

### 优先级高
- [ ] 添加各工具详细使用示例
- [ ] 添加错误处理示例
- [ ] 完善依赖管理说明 (强调使用update_task)
- [ ] 增加PRD解析最佳实践
- [x] 更新API参考文档，包含expand_task和get_next_executable_task的变更
- [x] 更新API参考文档，移除mark_task_done并强调update_task用于完成任务
- [x] 更新实现指南文档，反映当前项目结构和最新实现

### 优先级中
- [ ] 编写测试指南
- [ ] 编写部署文档
- [ ] 添加性能优化说明
- [x] 编写贡献指南 (contributing.md)
- [x] 添加subtasks字段和子任务管理的文档说明

### 优先级低
- [ ] 编写高级使用场景
- [ ] 增加与其他工具集成指南
- [ ] 编写常见问题解答
- [ ] 多语言文档支持

## 3. 测试与验证

### 必须完成
- [ ] 创建基本单元测试
- [ ] 测试所有工具功能 (包括update_task的依赖更新)
- [ ] 测试任务状态转换
- [ ] 测试依赖关系管理 (包括循环依赖检测)
- [ ] 测试错误处理
- [ ] 测试子任务管理功能

### 优先级高
- [ ] 编写集成测试
- [ ] 测试PRD解析功能
- [x] 修复MCP服务错误处理
- [ ] 进行性能基准测试
- [ ] 测试并发调用

### 优先级中
- [ ] 编写端到端测试
- [ ] 测试不同Python版本兼容性
- [ ] 测试服务崩溃恢复
- [ ] 测试大规模任务管理

### 优先级低
- [ ] 进行安全测试
- [ ] 进行负载测试
- [ ] 测试分布式部署
- [ ] 用户体验测试

## 4. 部署与发布

### 必须完成
- [ ] 创建Docker镜像
- [ ] 编写部署脚本
- [ ] 测试基本部署
- [ ] 编写版本发布流程

### 优先级高
- [ ] 配置CI/CD流程
- [ ] 创建演示环境
- [ ] 发布初始版本
- [ ] 创建项目主页

### 优先级中
- [ ] 实现自动化测试
- [ ] 配置Docker Compose支持
- [ ] 添加监控支持
- [ ] 实现备份恢复机制

### 优先级低
- [ ] 实现Kubernetes部署
- [ ] 配置高可用部署
- [ ] 实现性能监控
- [ ] 添加使用统计

## 5. 社区与拓展

### 优先级高
- [ ] 创建示例项目
- [ ] 编写教程文章
- [ ] 收集使用反馈
- [ ] 实现常见功能扩展

### 优先级中
- [ ] 建立社区讨论
- [ ] 开发插件系统
- [ ] 支持第三方集成
- [ ] 创建贡献指南

### 优先级低
- [ ] 创建视频教程
- [ ] 举办社区活动
- [ ] 开发高级扩展
- [ ] 建立生态系统

## 时间线

| 阶段 | 估计完成时间 | 主要任务 |
|------|------------|---------|
| 阶段1 | 2周 | 完成基础框架和核心工具 |
| 阶段2 | 2周 | 完善功能和文档 |
| 阶段3 | 1周 | 测试和修复 |
| 阶段4 | 1周 | 部署和发布 |
| 阶段5 | 持续 | 社区建设和功能扩展 |

## 注意事项

- 保持与MCP规范的一致性
- 确保工具名称和参数使用正确格式：`@mcp.tool("工具ID")`
- 重点关注错误处理和用户体验
- 保持文档的同步更新
- 优先实现核心功能，再扩展高级特性
- 定期回顾和调整优先级 

## 已完成任务

### 2023-06-01
- [x] 项目初始化

### 2023-06-15
- [x] 基本任务管理功能实现
- [x] 任务依赖关系管理

### 2023-07-10
- [x] 代码引用功能

### 2023-07-20
- [x] 重构：提取通用功能到utils目录
  - 创建file_operations.py - 包含文件操作相关工具函数
  - 创建task_utils.py - 包含任务工具函数
  - 创建logging_config.py - 包含日志配置工具函数
  - 更新__init__.py导出这些功能
  - 重构server.py使用这些工具函数

### 2023-07-25
- [x] 增强：添加子任务状态与父任务状态同步
  - 当子任务状态更新时，自动更新父任务状态
  - 所有子任务完成时，父任务状态自动设为完成
  - 任一子任务阻塞时，父任务状态自动设为阻塞
  - 任一子任务进行中时，父任务状态自动设为进行中

### 2023-07-30
- [x] 改进：优化get_next_executable_task工具
  - 添加对进行中(in_progress)任务的优先返回
  - 考虑父子任务关系，显示进行中父任务的子任务优先级
  - 完全符合MCP规则文档中定义的任务排序逻辑
  - 增强函数文档说明

### 2025-04-14
- [x] 功能增强：Task模型添加subtasks属性，支持嵌套子任务结构
- [x] 修改：更新_task_to_dict方法返回subtasks字段
- [x] 改进：优化get_next_executable_task工具，仅返回单个最优先任务

### 2025-04-15
- [x] 简化API：移除mark_task_done工具，改为统一使用update_task来更新任务状态
- [x] 文档更新：更新API参考和MCP规则文档，移除mark_task_done并强调使用update_task

### 2025-04-20
- [x] 修复：改进子任务状态更新逻辑，支持直接更新subtasks字段中的子任务
- [x] 文档更新：更新API参考和MCP规则文档，添加子任务更新说明
- [x] 增强：添加自动同步父任务状态的功能，当子任务状态变更时自动更新父任务状态
- [x] 修复：改进子任务代码引用更新逻辑，支持直接更新subtasks字段中的子任务代码引用
- [x] 文档更新：更新API参考和MCP规则文档，添加子任务代码引用更新说明
- [x] 功能增强：update_task工具支持更新任务的依赖关系（dependencies字段）
- [x] 文档更新：更新API参考和MCP规则文档，反映update_task对依赖关系更新的支持
- [x] 简化API：移除 set_task_dependency 和 remove_task_dependency 工具，功能合并至 update_task

## 待完成任务

- [ ] 任务时间线可视化功能
- [ ] 团队协作功能
- [ ] 任务导出功能
- [ ] 自动化测试完善
- [ ] 更新API参考文档，反映最新subtasks结构

## 文档

- [x] 完善设计文档，包括任务模型和API
- [x] 编写快速入门指南
- [x] 添加详细API参考文档
- [x] 添加安装指南
- [x] 更新README以反映当前特性和安装方法
- [x] 更新配置示例文档
- [x] 明确服务中要求使用绝对路径的地方

## 实现

- [x] 基础任务存储
- [x] 任务依赖关系管理
- [x] 文件存储支持(JSON/Markdown)
- [x] 任务服务实现
- [x] MCP工具封装
- [x] 添加PRD解析功能
- [x] 支持依赖分析
- [x] 支持文件导出
- [ ] 增加数据库持久化存储
- [ ] 添加统计功能
- [ ] 添加更多测试用例

## 集成

- [x] 集成LLM用于PRD解析
- [x] 支持Gemini模型
- [x] 支持OpenAI模型
- [x] 支持子任务自动生成
- [ ] 实现Web UI界面
- [ ] 与项目管理工具集成

## 部署

- [x] 完善Docker支持
- [ ] 添加CI/CD配置
- [ ] 添加自动测试
- [ ] 优化性能
- [ ] 添加监控 